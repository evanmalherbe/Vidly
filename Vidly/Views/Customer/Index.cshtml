@model Vidly.ViewModels.CustomerViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
  var count = 1;
}

<h2>Customers</h2>
<a href="/Customer/new" class="btn btn-primary mb-2">New Customer</a>

@if (Model.Customers.Count == 0)
{
  <p>No customers loaded.</p>
}
else
{
  <table id="customers" class="table table-hover">
    <thead>
      <tr>
        <th>Customers</th>
        <th>Membership Type</th>
        <th>Delete</th>
      </tr>
    </thead>
      <tbody>
        @foreach (var customer in Model.Customers)
        {
          <tr>
            <td><a href="/Customer/Details/@count">@customer.Name</a></td>
            <td>@customer.MembershipType.Name</td>
            <td>
              <button data-customer-id="@customer.Id" class="btn btn-link js-delete">Delete</button>
            </td>
          </tr>
          count++;
        }
      </tbody>
</table>
}

@section scripts
{
  <script>
    $(document).ready(function ()
    {
      $("#customers").DataTable();

			$("#customers").on("click", ".js-delete", function ()
      {
        var button = $(this);

        bootbox.confirm("Are you sure you want to delete this customer?", function (result)
        {
          if (result)
          {
						$.ajax({
							url: "/api/customers/" + button.attr("data-customer-id"),
							method: "DELETE",
							success: function ()
							{
								button.parents("tr").remove();
							}
						});
          }
        })
      });
    });
  </script>
}

